@startuml credential_rotation_architecture
!theme plain
skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

title Terraform Credential Rotation System Architecture

package "Main Entry Point" {
  [main.tf] as Main
}

package "Core Engine" {
  package "engine/" {
    package "init" {
      [Load configs] as load_configs
    }
    package "Secret loading" {
      [rotate] as Rotate
      [get] as get
      [secrets] as secret_map
    }
    package "Secret utilization" {
      [deploy] as Deploy
    }
  }
}

package "Shared Resources" {
  [constants/] as Constants
}

package "configurations/" {
  package "<service>/" as service_configs {
    [deployment/] as deployment_configs
    [rotation/] as rotation_configs
    [get/] as get_configs
  }
}

package "Extensions" {
  package "<service>/" as service_extensions {
    package "deployment/" {
    }
    package "rotation/" {
    }
    package "get/" {
    }
  }
}

' Main flow
Main --> load_configs : loads configurations
load_configs --> Rotate : ["rotation"]
load_configs --> get : ["get"]
load_configs --> Deploy : ["deployment"]
Rotate --> secret_map
Rotate --> "rotation/"
get --> "get/"
get --> secret_map
secret_map --> Deploy : var.secrets

' Extension discovery
load_configs <-- rotation_configs
load_configs <-- deployment_configs
load_configs <-- get_configs


' Deployment targets
Deploy --> "deployment/" : deploys credentials

note right of "Shared Resources"
  Contains shared constants used across
  the entire architecture
end note
@enduml
